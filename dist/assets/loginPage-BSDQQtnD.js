import{c as C,C as E,a as R}from"./captcha_api-BoEGUBqZ.js";import{R as W,p as V,d as D,i as S,_ as I,r as n,e as M,o as j,w as a,a as t,f as l,t as s,g as B}from"./index-DhQyue9E.js";import{S as z}from"./SidebarLayout-BFiLSXIf.js";import{n as G}from"./navbar_welcome-eqeg3_fO.js";import{H as J}from"./homeBtn-BchB0e08.js";import{f as K,s as u}from"./showFloatingAlert-B-wYDDm6.js";import{l as O}from"./leftSidebarColumns-NaY1R2Vv.js";import"./translateBtn-C87KYO5l.js";import"./compactFolderList-CJ0MtlWe.js";import"./defaultAvatar-DOZV4EYv.js";import"./navUserAvatarPrompt-BRRxG_qO.js";import"./parrotLogoBtn-fE2VUJDE.js";class F{static async loginUserByPassword(o){const r={method:"password"};return W(()=>V("auth/login/",o,r))}static async loginUserByCaptcha(o){return V("auth/login/",o,{method:"captcha"})}}const Q=D({name:"LoginPage",components:{FloatingAlert:K,navbar_welcome:G,HomeBtn:J,SidebarLayout:z,LeftSidebarWelcome:O},setup(){return{rules:{required(o){return!!o||S.global.t("login.warns.required")},is_email(o){return C(o)||S.global.t("login.warns.emailNotValid")}}}},data(){return{tab:null,showPassword:!1,isLoadingCaptcha:!1,loginAlert:{show:!1,type:"success",title:"",text:""},isLoading:!1,LoginForm_username:{username:"",password:""},LoginForm_email:{email:"",verification_code:""}}},methods:{async getLoginCaptcha(e){if(this.isLoadingCaptcha=!0,!C(this.LoginForm_email.email||""))u(this.$refs.emailAlert,!1,this.$t("login.warns.emailNotValid"));else try{const o=await E.getCaptcha(R.login,{email:this.LoginForm_email.email});u(this.$refs.emailAlert,!0,this.$t("login.warns.emailSendSucceed"))}catch(o){u(this.$refs.emailAlert,!1,o.message??this.$t("login.warns.UnknownError"))}this.isLoadingCaptcha=!1},redirectToHomePage(){this.$router.push("/home")},async submitLoginByUserName(e){this.isLoading=!0;let o=!1,r="";if((await e).valid===!0)try{const m=this.LoginForm_username,c=await F.loginUserByPassword(m);o=!0,r=this.$t("login.warns.LoginSucceed")}catch(m){r=this.$t("login.warns.LoginFailed")+" : "+m.message}finally{u(this.$refs.emailAlert,o,r),o&&setTimeout(this.redirectToHomePage,1e3)}this.isLoading=!1},async submitLoginByEmail(e){this.isLoading=!0;let o=!1,r="";if((await e).valid===!0)try{const m=this.LoginForm_email,c=await F.loginUserByCaptcha(m);o=!0,r=this.$t("login.warns.LoginSucceed")}catch(m){console.error(m),o=!1,r=this.$t("login.warns.LoginFailed")+" : "+m.message}finally{u(this.$refs.emailAlert,o,r),o&&setTimeout(this.redirectToHomePage,2e3)}this.isLoading=!1}}});function X(e,o,r,f,_,m){const c=n("LeftSidebarWelcome"),P=n("HomeBtn"),U=n("navbar_welcome"),h=n("v-tab"),A=n("v-tabs"),g=n("v-text-field"),d=n("v-btn"),b=n("v-spacer"),w=n("v-card-actions"),v=n("v-form"),p=n("v-card-text"),L=n("v-divider"),y=n("router-link"),$=n("v-tabs-window-item"),k=n("v-tooltip"),H=n("v-tabs-window"),N=n("v-card"),T=n("floatingAlert"),q=n("SidebarLayout");return j(),M(q,null,{"sidebar-left-content":a(()=>[t(c)]),"main-content":a(()=>[t(U,{showRightSidebarToggle:!1,showLogo:!1},{navbarPrepend:a(()=>[t(P)]),_:1}),t(N,{width:"400",class:"mx-auto mt-8",elevation:"12"},{default:a(()=>[t(A,{modelValue:e.tab,"onUpdate:modelValue":o[0]||(o[0]=i=>e.tab=i),"bg-color":"#493545",grow:"",disabled:e.isLoading},{default:a(()=>[t(h,{value:"username_login"},{default:a(()=>[l(s(e.$t("login.byUsername")),1)]),_:1}),t(h,{value:"email_login"},{default:a(()=>[l(s(e.$t("login.byEmail")),1)]),_:1})]),_:1},8,["modelValue","disabled"]),t(H,{modelValue:e.tab,"onUpdate:modelValue":o[7]||(o[7]=i=>e.tab=i)},{default:a(()=>[t($,{value:"username_login"},{default:a(()=>[t(p,null,{default:a(()=>[t(v,{onSubmit:B(e.submitLoginByUserName,["prevent"])},{default:a(()=>[t(g,{label:e.$t("login.Username"),rules:[e.rules.required],modelValue:e.LoginForm_username.username,"onUpdate:modelValue":o[1]||(o[1]=i=>e.LoginForm_username.username=i),maxlength:"20",type:"text","prepend-icon":"mdi-account-circle"},null,8,["label","rules","modelValue"]),t(g,{label:e.$t("login.Password"),modelValue:e.LoginForm_username.password,"onUpdate:modelValue":o[2]||(o[2]=i=>e.LoginForm_username.password=i),maxlength:"20",rules:[e.rules.required],type:e.showPassword?"text":"password","prepend-icon":"mdi-lock","append-inner-icon":e.showPassword?"mdi-eye":"mdi-eye-off","onClick:appendInner":o[3]||(o[3]=()=>e.showPassword=!e.showPassword)},null,8,["label","modelValue","rules","type","append-inner-icon"]),t(w,null,{default:a(()=>[t(d,{class:"text-white bg-grey"},{default:a(()=>[l(s(e.$t("login.CancelBtn")),1)]),_:1}),t(b),t(d,{class:"text-white bg-success",type:"submit",loading:e.isLoading},{default:a(()=>[l(s(e.$t("login.LoginBtn")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1}),t(p,null,{default:a(()=>[t(L),l(" "+s(e.$t("login.NotRegistered"))+" ",1),t(y,{style:{color:"blue","text-decoration":"underline"},to:"/auth/register"},{default:a(()=>[l(s(e.$t("login.Signup")),1)]),_:1})]),_:1})]),_:1}),t($,{value:"email_login"},{default:a(()=>[t(p,null,{default:a(()=>[t(v,{onSubmit:B(e.submitLoginByEmail,["prevent"])},{default:a(()=>[t(g,{label:e.$t("login.Email"),modelValue:e.LoginForm_email.email,"onUpdate:modelValue":o[4]||(o[4]=i=>e.LoginForm_email.email=i),maxlength:"200",rules:[e.rules.required,e.rules.is_email],type:"email","prepend-icon":"mdi-email"},null,8,["label","modelValue","rules"]),t(g,{label:e.$t("login.Captcha"),rules:[e.rules.required],maxlength:"6",type:"text",modelValue:e.LoginForm_email.verification_code,"onUpdate:modelValue":o[6]||(o[6]=i=>e.LoginForm_email.verification_code=i),"prepend-icon":"mdi-shield-key"},{append:a(()=>[t(d,{class:"text-white bg-info",onClick:o[5]||(o[5]=i=>e.getLoginCaptcha(null)),loading:e.isLoadingCaptcha},{default:a(()=>[l(s(e.$t("login.SendCodeBtn"))+" ",1),t(k,{activator:"parent",location:"bottom"},{default:a(()=>[l(s(e.$t("login.CaptchaTooltip")),1)]),_:1})]),_:1},8,["loading"])]),_:1},8,["label","rules","modelValue"]),t(w,null,{default:a(()=>[t(d,{class:"text-white bg-grey",width:"100px"},{default:a(()=>[l(s(e.$t("login.CancelBtn")),1)]),_:1}),t(b),t(d,{class:"text-white bg-success",width:"100px",type:"submit"},{default:a(()=>[l(s(e.$t("login.LoginBtn")),1)]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1}),t(p,null,{default:a(()=>[t(L),l(" "+s(e.$t("login.NotRegistered"))+" ",1),t(y,{style:{color:"blue","text-decoration":"underline"},to:"/auth/register"},{default:a(()=>[l(s(e.$t("login.Signup")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(T,{ref:"emailAlert"},null,512)]),_:1})}const me=I(Q,[["render",X]]);export{me as default};
