import{d as B,_ as z,r as o,c as u,o as n,a as s,w as a,b as i,g as L,f as d,t as r,m as k,U as G,F as C,W as q,s as O,q as S,e as y,i as Q,l as x,X as ee,K as te,z as ae}from"./index-DhQyue9E.js";import{H as se,u as oe}from"./history_api-gh_lP_eU.js";import{t as H,g as ne,p as re,D as F}from"./postBlogOverlay-DWFCMgHr.js";import{I as K,c as j}from"./index-Bg61085d.js";import{f as M,s as A}from"./showFloatingAlert-B-wYDDm6.js";import{d as ie}from"./defaultAvatar-DOZV4EYv.js";import{U as le,G as de}from"./time_zone-CIJT9WYk.js";import{E as me,m as ce}from"./css-vars-BbjLLMvg.js";import{c as ue,s as pe}from"./showConfirmDialog-DideKGsE.js";import{B as ge,a as R}from"./blog_services-Dv4Slcqr.js";import{m as he}from"./stdDataTableServer-DK0Vgekt.js";import{b as fe}from"./blog_iterator_main-CID9z7H4.js";import"./detailedIteratorList-Dgs8FooO.js";import"./index-CzMClYPS.js";import"./isSymbol-C7jn4vLP.js";import"./index-B_XxqfCF.js";import"./toString-CyGcNvj-.js";import"./accounts_api-DW2whro8.js";const _e=B({name:"SearchOverlayGlobal",data(){return{search:"",isShow:!1,searchIsFocused:!1}},methods:{show(){this.isShow=!0},toggleSearchOverlay(){this.isShow=!this.isShow}},watch:{isShow(e){e||this.$emit("close")}}}),ve={class:"search-bar-container"};function ye(e,t,c,f,_,v){const l=o("v-icon"),m=o("v-btn"),p=o("v-text-field"),h=o("v-card"),P=o("v-overlay");return n(),u("div",null,[s(P,{modelValue:e.isShow,"onUpdate:modelValue":t[5]||(t[5]=w=>e.isShow=w),class:"search-overlay",width:"100%",height:"100%","scroll-strategy":"none",onClick:t[6]||(t[6]=w=>e.isShow=!1)},{default:a(()=>[i("div",{class:"search-card-container",onClick:t[4]||(t[4]=L(()=>{},["stop"]))},[s(h,{class:"overlay-search-card"},{default:a(()=>[i("div",ve,[s(p,{modelValue:e.search,"onUpdate:modelValue":t[1]||(t[1]=w=>e.search=w),class:"search-bar bg-searchbar","prepend-inner-icon":"mdi-magnify",placeholder:e.searchIsFocused?"":e.$t("home.main_view.search_not_supported"),variant:"plain","hide-details":"",onFocus:t[2]||(t[2]=w=>e.searchIsFocused=!0),onFocusout:t[3]||(t[3]=w=>e.searchIsFocused=!1)},{append:a(()=>[s(m,{variant:"plain",icon:"",size:"small",onClick:t[0]||(t[0]=w=>e.isShow=!1)},{default:a(()=>[s(l,{class:"search-icon"},{default:a(()=>t[7]||(t[7]=[d(r("mdi-close"))])),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"])])]),_:1})])]),_:1},8,["modelValue"])])}const we=z(_e,[["render",ye],["__scopeId","data-v-814eb863"]]),be=B({name:"DynamicSearchBtn",props:{color:{type:String,default:"primary"}},components:{searchOverlayGlobal:we},data(){return{isSearching:!1}},methods:{showSearchOverlay(){const e=this.$refs.searchOverlayGlobal;e&&(this.isSearching=!0,e.show())},handleKeyDown(e){e.key==="k"&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.showSearchOverlay())}},mounted(){window.addEventListener("keydown",this.handleKeyDown)},beforeDestroy(){window.removeEventListener("keydown",this.handleKeyDown)}}),Te={key:0,class:"search-btn-container"};function $e(e,t,c,f,_,v){const l=o("searchOverlayGlobal"),m=o("v-btn");return n(),u(C,null,[s(l,{ref:"searchOverlayGlobal",onClose:t[0]||(t[0]=p=>e.isSearching=!1)},null,512),s(G,{name:"slide-reveal"},{default:a(()=>[e.isSearching?k("",!0):(n(),u("div",Te,[s(m,{color:e.color,rounded:"",class:"search-btn",width:"90%",height:"75%","prepend-icon":"mdi-magnify",onClick:t[1]||(t[1]=p=>e.showSearchOverlay())},{default:a(()=>[d(r(e.$t("home.main_view.search_placeholder")),1)]),_:1},8,["color"])]))]),_:1})],64)}const W=z(be,[["render",$e],["__scopeId","data-v-9fc087da"]]),ke=B({name:"NewTagPrompt",components:{floatingAlert:M},data(){return{isOpen:!1,newTagForm:{key:"",en:"",zh:""}}},methods:{show(){this.isOpen=!0},async addNewTag(){const e=this.newTagForm,t=this.$refs.floatingAlert;try{await K.addNewTagToDatabase(e),A(t,!0,this.$t("common.newTagPrompt.successAddTag")),this.newTagForm={key:"",en:"",zh:""}}catch(c){A(t,!1,this.$t("common.newTagPrompt.errorAddTag")+" : "+c.message)}},handleEnterKey(e){this.isOpen&&e.key==="Enter"&&this.addNewTag()}},mounted(){window.addEventListener("keydown",e=>{this.handleEnterKey(e)})},beforeUnmount(){window.removeEventListener("keydown",e=>{this.handleEnterKey(e)})}}),Pe={class:"new-tag-prompt"},De={class:"headline"};function Ce(e,t,c,f,_,v){const l=o("v-card-title"),m=o("v-text-field"),p=o("v-btn"),h=o("v-spacer"),P=o("v-card-actions"),w=o("v-card"),I=o("floatingAlert"),g=o("v-dialog");return n(),u("div",Pe,[s(g,{modelValue:e.isOpen,"onUpdate:modelValue":t[4]||(t[4]=b=>e.isOpen=b),"max-width":"500px"},{default:a(()=>[s(w,null,{default:a(()=>[s(l,null,{default:a(()=>[i("span",De,r(e.$t("common.newTagPrompt.title")),1)]),_:1}),s(m,{modelValue:e.newTagForm.key,"onUpdate:modelValue":t[0]||(t[0]=b=>e.newTagForm.key=b),class:"tag-prompt-input",label:e.$t("common.newTagPrompt.tagKey")},null,8,["modelValue","label"]),s(m,{modelValue:e.newTagForm.en,"onUpdate:modelValue":t[1]||(t[1]=b=>e.newTagForm.en=b),class:"tag-prompt-input",label:e.$t("common.newTagPrompt.tagTranslationEn")},null,8,["modelValue","label"]),s(m,{modelValue:e.newTagForm.zh,"onUpdate:modelValue":t[2]||(t[2]=b=>e.newTagForm.zh=b),class:"tag-prompt-input",label:e.$t("common.newTagPrompt.tagTranslationZh")},null,8,["modelValue","label"]),s(P,{class:"mb-2 ml-2 mr-2"},{default:a(()=>[s(p,{color:"secondary",variant:"outlined",onClick:t[3]||(t[3]=b=>e.isOpen=!1)},{default:a(()=>[d(r(e.$t("g.cancel")),1)]),_:1}),s(h),s(p,{color:"primary",variant:"outlined",onClick:e.addNewTag},{default:a(()=>[d(r(e.$t("common.newTagPrompt.confirmAddTag")),1)]),_:1},8,["onClick"])]),_:1})]),_:1}),s(I,{ref:"floatingAlert"},null,512)]),_:1},8,["modelValue"])])}const Y=z(ke,[["render",Ce],["__scopeId","data-v-4048e811"]]),Ie=B({name:"InterestTagPanel",components:{tagChooseOverlay:H,newTagPrompt:Y,floatingAlert:M},data(){return{user:O.state.user,maxUserTagNum:15}},computed:{userInterestTags(){return O.state.user_personal_data.interest_tags},recommendInterestTags(){return O.state.user_personal_data.recommend_tags}},methods:{showAddUserInterestTagOverlay(){const e=this.$refs.addUserInterestTagOverlay;e&&e.show(this.userInterestTags.slice(0))},showNewTagPrompt(){this.$refs.newTagPrompt.show()},getTagTranslation(e){const t=this.$i18n.locale;return e[t]??e.en??e},async updateUserInterestTags(e){try{const t=await q.update_user_interest_tags(e);A(this.$refs.floatingAlert,!0,t)}catch(t){this.showErrorAlert(t.message)}},async deleteInterestTags(e){try{await K.deleteTagFromDatabase(e.map(t=>t.key)),A(this.$refs.floatingAlert,!0,this.$t("common.tag_overlay.delete_success"))}catch(t){this.showErrorAlert(t.message)}},showDeleteTagOverlay(){this.$refs.deleteUserInterestTagOverlay.show()},showErrorAlert(e){A(this.$refs.floatingAlert,!1,e)}}}),Ae={class:"interesting-tag-panel"},Se={class:"interested-tags"},Ne={class:"interested-tag-header-container"},Oe={class:"interested-tag-wrapper"},Be=["href"],ze={class:"recommended-tags"},Ue={class:"interested-tag-header-container"},Ve=["href"],Le={class:"manager-tag-add-button-container"};function Me(e,t,c,f,_,v){const l=o("v-divider"),m=o("v-chip"),p=o("v-chip-group"),h=o("v-btn"),P=o("newTagPrompt"),w=o("tagChooseOverlay"),I=o("floatingAlert");return n(),u(C,null,[i("div",Ae,[i("div",Se,[i("div",Ne,r(e.$t("g.myIntersetTags")),1),s(l),i("div",Oe,[s(p,{class:"interested-tag-container",column:""},{default:a(()=>[(n(!0),u(C,null,S(e.userInterestTags,(g,b)=>(n(),y(m,{variant:"outlined",key:b,class:"interest-tag"},{default:a(()=>[i("a",{href:"/blogs?tag="+g.key},r(g[e.$i18n.locale]??g.key),9,Be)]),_:2},1024))),128)),s(m,{variant:"outlined",class:"interest-tag","prepend-icon":e.userInterestTags.length<e.maxUserTagNum?"mdi-plus-circle-outline":"mdi-minus-circle-outline",onClick:e.showAddUserInterestTagOverlay},{default:a(()=>[d(r(e.userInterestTags.length<e.maxUserTagNum?e.$t("g.addNewTag"):e.$t("g.deleteTag")),1)]),_:1},8,["prepend-icon","onClick"])]),_:1})])]),i("div",ze,[i("div",Ue,r(e.$t("g.myRecommendedTags")),1),s(l),s(p,{class:"recommended-tag-container",column:""},{default:a(()=>[(n(!0),u(C,null,S(e.recommendInterestTags,(g,b)=>(n(),y(m,{key:b,class:"interest-tag"},{default:a(()=>[i("a",{href:"/blogs?tag="+g.key},r(e.getTagTranslation(g)),9,Ve)]),_:2},1024))),128))]),_:1})]),i("div",Le,[e.user.priority<=1?(n(),y(h,{key:0,color:"info",rounded:"",style:{width:"100%"},onClick:t[0]||(t[0]=g=>e.showNewTagPrompt())},{default:a(()=>[d(r(e.$t("g.addNewTagToDDatabase")),1)]),_:1})):k("",!0),s(P,{ref:"newTagPrompt"},null,512),e.user.priority<=1?(n(),y(h,{key:1,color:"error",rounded:"",style:{width:"100%"},onClick:t[1]||(t[1]=g=>e.showDeleteTagOverlay())},{default:a(()=>[d(r(e.$t("g.deleteTagFromDDatabase")),1)]),_:1})):k("",!0)])]),s(w,{ref:"addUserInterestTagOverlay",hideAfterAdd:!1,showTagContainer:!0,maxTagCount:e.maxUserTagNum,allowRepeatTags:!1,onConfirm:e.updateUserInterestTags},{title:a(()=>[d(r(e.$t("common.tag_overlay.card_title_add")),1)]),"current-tags-tip":a(()=>[d(r(e.$t("common.tag_overlay.current_tags"))+"} ",1)]),_:1},8,["maxTagCount","onConfirm"]),s(w,{ref:"deleteUserInterestTagOverlay",hideAfterAdd:!1,showTagContainer:!0,maxTagCount:1e3,allowRepeatTags:!1,onConfirm:e.deleteInterestTags},{title:a(()=>[d(r(e.$t("common.tag_overlay.card_title_delete")),1)]),"current-tags-tip":a(()=>[d(r(e.$t("common.tag_overlay.selected_tags")),1)]),"add-icon":a(()=>t[2]||(t[2]=[d(r("mdi-delete-forever"))])),_:1},8,["onConfirm"]),s(I,{ref:"floatingAlert"},null,512)],64)}const Ee=z(Ie,[["render",Me],["__scopeId","data-v-f62ad331"]]),Ke=B({name:"BriefIteratorList",components:{ElInput:ne,ElButton:ce,ElTag:me,defaultAvatar:ie},props:{isVisible:{type:Boolean,default:!0},autoHideDate:{type:Boolean,default:!0},maxTagsDisplay:{type:Number,default:3},items:{type:Array,required:!0},itemsLength:{type:Number,required:!0},showExtraMenuBtn:{type:Boolean,default:!1},extraMenuBtnItem:{type:Array,default:[]},itemsPerPage:{type:Number,default:10},itemsPerPageMax:{type:Number,default:10},useTranslation:{type:Boolean,default:!0},noDataText:{type:String,default:Q.global.t("common.briefDataIterator.noDataText")},showLimitationInfo:{type:Boolean,default:!1},limitationTextKey:{type:String,default:""},limitationText:{type:String,default:"limit:"},limitationNum:{type:Number,default:20},menus:{type:Object,default:{items:[]}},minShowDateWidth:{type:Number,default:350}},data(){return{showDate:!0,current_page:1,jumpingPage:!1,jumpPageText:"",useMaxPageSize:!1}},emits:["fetchData"],computed:{pageCount(){const e=Math.ceil(this.itemsLength/(this.useMaxPageSize?this.itemsPerPageMax:this.itemsPerPage));return this.current_page>e&&(this.current_page=e),e}},watch:{isVisible:{handler(e){e&&x(()=>{this.updateDateVisibility()})},immediate:!0},current_page:{handler(e){this.update()}}},methods:{updateDateVisibility(){const e=this.$refs.list;if(e)if(this.autoHideDate){const t=e.$el.getBoundingClientRect().width;this.showDate=!(t<this.minShowDateWidth)}else this.showDate=!0},handleChiplick(e){const t=e.target;t!=null&&!t.classList.contains("brief-iterator-item-tags")&&e.stopPropagation()},handleMenuToggleBtnClick(e){e.stopPropagation(),e.preventDefault()},toggleMaxPageSize(){this.useMaxPageSize=!this.useMaxPageSize,this.update()},getTimeString(e){return e?new Date(e).getTime()<Date.now()-7*24*60*60*1e3?le(e,"YYYY-MM-DD"):de(e):""},handleMenuItemClick(e,t){e.callback&&e.callback(t.call_back_params??t)},getTagTranslation(e){const t=this.$i18n.locale;return e[t]??e.en??e.key},fetchData(e){this.$emit("fetchData",e)},update(){const e={pageNum:this.current_page,itemsPerPage:this.useMaxPageSize?this.itemsPerPageMax:this.itemsPerPage};this.fetchData(e)},async jumpToPage(){try{await this.update();const e=Math.floor(Number(this.jumpPageText));if(isNaN(e))return;const t=this.useMaxPageSize?Math.ceil(this.itemsLength/this.itemsPerPageMax):Math.ceil(this.itemsLength/this.itemsPerPage);this.current_page=Math.min(Math.max(e,1),t),this.jumpPageText=this.current_page.toString()}catch(e){console.error(e)}}},mounted(){this.updateDateVisibility(),window.addEventListener("resize",this.updateDateVisibility)},beforeDestroy(){window.removeEventListener("resize",this.updateDateVisibility)}}),Fe={class:"brief-iterator-list"},je={key:0,class:"no-data-text"},Re={class:"brief-iterator-item-container"},Ge={class:"brief-iter-item-text-part"},qe={class:"brief-iterator-list-item-title-text"},He={key:0,class:"status-tag-group ml-2"},We={class:"brief-iter-item-tags-part"},Ye={key:1,class:"brief-iterator-list-author-info"},Je={class:"brief-iterator-list-author-avatar"},Xe=["src"],Ze={class:"brief-iterator-list-author-name"},Qe={key:0,class:"time-label-wrapper"},xe={key:0,class:"time-label"},et={class:"time-label-container"},tt={class:"brief-iter-item-action-info-part"},at={class:"brief-iterator-item-menu-btn"},st={style:{"padding-left":"5px"}},ot={class:"brief-iterator-list-footer"},nt={key:0,class:"current-page-show-banner"},rt={key:1,class:"jump-page-banner"},it={class:"footer-right-part"},lt={key:0,class:"limitation-info"},dt={key:1,class:"page-limit-switcher"};function mt(e,t,c,f,_,v){const l=o("el-tag"),m=o("v-list-item-title"),p=o("v-chip"),h=o("v-icon"),P=o("v-chip-group"),w=o("defaultAvatar"),I=o("v-label"),g=o("v-btn"),b=o("v-list-item"),E=o("v-divider"),$=o("v-list"),N=o("v-menu"),J=o("el-input"),X=o("v-data-iterator");return n(),u("div",Fe,[e.items.length===0?(n(),u("div",je,r(e.noDataText),1)):(n(),y(X,{key:1,items:e.items,page:e.current_page,"items-per-page":e.useMaxPageSize?e.itemsPerPageMax:e.itemsPerPage},{default:a(({items:U})=>[s($,{ref:"list"},{default:a(()=>[(n(!0),u(C,null,S(U,(T,Z)=>(n(),y(b,{class:"brief-iterator-list-item",key:`list-item-${T.raw.link}-${Z}`,to:T.raw.link},{default:a(()=>[i("div",Re,[i("div",Ge,[s(m,{class:"brief-iterator-list-item-title"},{default:a(()=>[i("div",qe,r(T.raw.title),1),T.raw.status!==void 0?(n(),u("div",He,[T.raw.status===2?(n(),y(l,{key:0,type:"success"},{default:a(()=>[d(r(e.$t("commmon.briefDataIterator.status.published")),1)]),_:1})):T.raw.status===1?(n(),y(l,{key:1,type:"warning"},{default:a(()=>[d(r(e.$t("commmon.briefDataIterator.status.reviewing")),1)]),_:1})):T.raw.status===0?(n(),y(l,{key:2,type:"danger"},{default:a(()=>[d(r(e.$t("commmon.briefDataIterator.status.rejected")),1)]),_:1})):k("",!0)])):k("",!0)]),_:2},1024),i("div",We,[i("div",null,[T.raw.tags!==void 0?(n(),y(P,{key:0,onClick:t[0]||(t[0]=L(D=>e.handleChiplick(D),["stop"])),column:""},{default:a(()=>[(n(!0),u(C,null,S(T.raw.tags.slice(0,3),(D,V)=>(n(),y(p,{class:"brief-iterator-item-tags",color:"info",size:"small",key:V,variant:"tonal",to:"/blogs?tag="+D.key},{default:a(()=>[d(r(e.getTagTranslation(D)),1)]),_:2},1032,["to"]))),128)),T.raw.tags.length>e.maxTagsDisplay?(n(),y(p,{key:0,icon:"",class:"brief-iterator-item-tags",color:"info",size:"small",variant:"tonal"},{default:a(()=>[s(h,null,{default:a(()=>t[7]||(t[7]=[d(r("mdi-dots-horizontal"))])),_:1})]),_:1})):k("",!0)]),_:2},1024)):k("",!0),T.raw.author_name||T.raw.author_avatar?(n(),u("div",Ye,[i("div",Je,[T.raw.author_avatar?(n(),u("img",{key:0,src:T.raw.author_avatar},null,8,Xe)):(n(),y(w,{key:1}))]),i("div",Ze,r(T.raw.author_name),1)])):k("",!0)]),e.showDate?(n(),u("div",Qe,[T.raw.datetime?(n(),u("div",xe,[i("span",et,[T.raw.datetime_info_text?(n(),y(I,{key:0},{default:a(()=>[d(r(T.raw.datetime_info_text),1)]),_:2},1024)):(n(),y(h,{key:1,size:"12",class:"mr-1"},{default:a(()=>[d(r(T.raw.datetime_info_icon||"mdi-clock-outline"),1)]),_:2},1024)),s(I,{class:"time-label-date"},{default:a(()=>[d(r(e.getTimeString(T.raw.datetime)),1)]),_:2},1024)])])):k("",!0)])):k("",!0)])]),i("div",tt,[i("div",at,[e.menus&&e.menus.items.length>0?(n(),y(N,{key:0,location:"start"},{activator:a(({props:D})=>[s(g,te({onClick:t[1]||(t[1]=L(V=>e.handleMenuToggleBtnClick(V),["stop"])),ref_for:!0},D,{variant:"text",size:"tiny",icon:"mdi-dots-horizontal",class:"pa-1"}),null,16)]),default:a(()=>[s($,{density:"compact"},{default:a(()=>[(n(!0),u(C,null,S(e.menus.items,(D,V)=>(n(),u("div",{key:V},[s(b,{to:D.url,onClick:jt=>e.handleMenuItemClick(D,T.raw)},{prepend:a(()=>[i("div",null,[s(h,null,{default:a(()=>[d(r(D.icon),1)]),_:2},1024)])]),default:a(()=>[i("span",st,r(e.useTranslation?e.$t(D.titleKey??"no title"):D.title),1)]),_:2},1032,["to","onClick"]),V<e.menus.items.length-1?(n(),y(E,{key:0})):k("",!0)]))),128))]),_:2},1024)]),_:2},1024)):k("",!0)])])])]),_:2},1032,["to"]))),128))]),_:2},1536)]),footer:a(()=>[i("div",ot,[i("div",{class:"page-info-banner",onClick:t[6]||(t[6]=U=>e.jumpingPage=!e.jumpingPage)},[s(G,{name:"fade-right"},{default:a(()=>[e.jumpingPage?(n(),u("div",rt,[d(r(e.$t("commmon.brief-iterator-list.jumping-page"))+" ",1),s(J,{onClick:t[4]||(t[4]=L(()=>{},["stop"])),size:"small",class:"jump-page-input",modelValue:e.jumpPageText,"onUpdate:modelValue":t[5]||(t[5]=U=>e.jumpPageText=U),"controls-position":"right",onKeydown:ee(e.jumpToPage,["enter"])},null,8,["modelValue","onKeydown"])])):(n(),u("div",nt,[s(g,{icon:"",class:"page-switch-btn",size:"small",variant:"plain",disabled:e.current_page<=1,onClick:t[2]||(t[2]=L(U=>e.current_page-=1,["stop"]))},{default:a(()=>[s(h,null,{default:a(()=>t[8]||(t[8]=[d(r("mdi-chevron-left"))])),_:1})]),_:1},8,["disabled"]),d(" "+r(e.$t("commmon.brief-iterator-list.page-info",{page:e.current_page,pageCount:e.pageCount}))+" ",1),s(g,{icon:"",class:"page-switch-btn",size:"small",variant:"plain",disabled:e.current_page>=e.pageCount,onClick:t[3]||(t[3]=L(U=>e.current_page+=1,["stop"]))},{default:a(()=>[s(h,null,{default:a(()=>t[9]||(t[9]=[d(r("mdi-chevron-right"))])),_:1})]),_:1},8,["disabled"])]))]),_:1})]),i("div",it,[e.showLimitationInfo?(n(),u("div",lt,r(e.limitationTextKey?e.$t(e.limitationTextKey):e.limitationText)+" "+r(e.itemsLength+" / "+e.limitationNum),1)):k("",!0),e.itemsPerPageMax>e.itemsPerPage?(n(),u("div",dt,[s(g,{size:"medium",variant:"plain",icon:"",onClick:e.toggleMaxPageSize},{default:a(()=>[s(h,null,{default:a(()=>[d(r(e.useMaxPageSize?"mdi-menu-up":"mdi-menu-down"),1)]),_:1})]),_:1},8,["onClick"])])):k("",!0)])])]),_:1},8,["items","page","items-per-page"]))])}const ct=z(Ke,[["render",mt],["__scopeId","data-v-882e2f1a"]]),ut={"-1":8e3,0:8e3,1:8e3,2:8e3,3:1e3,4:200,5:0},pt=B({name:"briefPostCard",components:{briefIteratorList:ct,floatingAlert:M,confirmDialog:ue,postBlogOverlay:re},props:{},computed:{currCardItems(){const e=this.post_card.tab_idx;return this.post_card.tabs[e].items}},setup(){return{user_priority:O.state.user.priority}},data(){return{confirmDialogAriticles:{title:"",subtitle:"",operation:"",uuid:""},small_width_layout:ae(!1),showJumpInput:!1,jumpPage:0,handleJumpPage:()=>{},history_list:[],post_card:{tab_idx:0,tabs:[{key:"history",titleKey:"common.post_card.history",icon:"mdi-clock-outline",items:[],cb:e=>this.fetch_history_data(e),itemsLength:0,limitation:100,limitationTextKey:"common.post_card.historyLimitation"},{key:"draft",icon:"mdi-pencil",titleKey:"common.post_card.drafts",title:"Drafts",items:[],itemsLength:0,cb:e=>this.fetch_draft_data(e),limitation:20,limitationTextKey:"common.post_card.draftLimitation",menus:{items:[{titleKey:"g.edit",icon:"mdi-pencil",callback:e=>{this.$router.push(`/drafts/edit/${e}`)}},{titleKey:"g.publish",icon:"mdi-upload",callback:e=>{const t=this.$refs.postBlogOverlay;t&&t.show(e)}},{titleKey:"g.delete",icon:"mdi-delete",callback:e=>{this.showConfirmArticlesDialog("delete",e,this.$t("common.post_card.deleteDraftConfirmTitle"),this.$t("common.post_card.deleteDraftConfirmSubtitle"))}}]}},{key:"posts",titleKey:"common.post_card.postFolder",title:this.$t("common.post_card.postFolder"),icon:"mdi-text-box-multiple-outline",items:[],itemsLength:0,cb:e=>this.fetch_user_posts_data(e),limitation:ut[this.user_priority.toString()||"5"],limitationTextKey:"common.post_card.postBlogLimitation"},{titleKey:"common.post_card.starFolder",title:this.$t("common.post_card.starFolder"),key:"stars",icon:"mdi-star-outline",items:[],itemsLength:0,cb:e=>[]}]}}},methods:{showErrorAlert(e){A(this.$refs.floatingAlert,!1,e)},PublishSuccessCb(e){var c;const t=(c=this.post_card.tabs.find(f=>f.key==="draft"))==null?void 0:c.items;if(t){const f=t.findIndex(_=>_.call_back_params===e);f>=0&&t.splice(f,1)}},showConfirmArticlesDialog(e,t,c="",f=""){const _=this.$refs.confirmDialogArticles;this.confirmDialogAriticles.title=c,this.confirmDialogAriticles.subtitle=f,this.confirmDialogAriticles.operation=e,this.confirmDialogAriticles.uuid=t,pe(_)},handleConfirmArticles(){const e=this.confirmDialogAriticles.operation,t=this.confirmDialogAriticles.uuid;switch(e){case"delete":this.delete_draft(t);break}},async fetch_draft_data(e){const t=this.post_card.tabs.map(c=>c.key).indexOf("draft");try{const c=await F.getUserDraftList(e),f=c.tableData,_=f.map(l=>l.tags).flat();await j.dispatch("updateInterestByKeys",_);const v=j.state.interest_tag_cache;this.post_card.tabs[t].items=f.map(l=>({title:l.title,tags:l.tags.map(m=>v.find(p=>p.key===m)),link:`/drafts/edit/${l.uuid}`,datetime:l.last_save_time,datetime_info_icon:"mdi-clock-outline",call_back_params:l.uuid})),this.post_card.tabs[t].itemsLength=c.count}catch(c){this.showErrorAlert(c.message)}},async fetch_history_list(){try{const t=(await se.getHistoryRecords()).records;this.history_list=t}catch(e){this.showErrorAlert(e.message)}},async fetch_history_data(e){if(!this.history_list)return;const t=this.post_card.tabs.map(v=>v.key).indexOf("history"),c=(e.pageNum-1)*e.itemsPerPage,f=c+e.itemsPerPage,_=this.history_list.slice(c,f).filter(v=>v.type==="blog");if(_.length!==0)try{const v=_.map(m=>m.uuid),l=await R.getBlogDisplayDataByUUID(v);this.post_card.tabs[t].items=l.map(m=>{var p;return{title:m.title,tags:m.tags,link:`/blogs/${m.uuid}`,datetime:(p=_.find(h=>h.uuid===m.uuid))==null?void 0:p.time,datetime_info_icon:"mdi-eye",author_avatar:m.authorAvatar,author_name:m.authorName}}),this.post_card.tabs[t].itemsLength=this.history_list.length}catch(v){this.showErrorAlert(v.message)}},async fetch_user_posts_data(e){const t=this.post_card.tabs.findIndex(c=>c.key==="posts");try{const c=he(e),f=await ge.getUserBlogList(c),_=f.tableData,v=await R.convertBlogToDisplayData(_);this.post_card.tabs[t].items=v.map(l=>{var p;const m=(p=_.find(h=>h.uuid===l.uuid))==null?void 0:p.status;return{title:l.title,tags:l.tags,link:m==2?`/blogs/${l.uuid}`:m==1?"#":`/blogs/revision/${l.uuid}`,datetime:l.lastModifyTime,status:m}}),this.post_card.tabs[t].itemsLength=f.count}catch(c){this.showErrorAlert(c.message)}},async delete_draft(e){var t;try{const f=(await F.deleteUserDraft(e)).data,_=(t=this.post_card.tabs.find(v=>v.key==="draft"))==null?void 0:t.items;if(_){const v=_.findIndex(l=>l.call_back_params===e);v>=0&&_.splice(v,1)}A(this.$refs.floatingAlert,!0,f)}catch(c){A(this.$refs.floatingAlert,!1,c.message)}},handleResize(){const e=this.$refs.card;if(e){const t=e.$el.getBoundingClientRect().width;this.small_width_layout=t<300}}},mounted(){this.handleResize(),window.addEventListener("resize",this.handleResize),(async()=>{await this.fetch_history_list();for(let e of this.post_card.tabs){const t={pageNum:1,itemsPerPage:5};e.cb&&await e.cb(t)}})()},watch:{tab_idx:{handler(e){}}},beforeUnmount(){window.removeEventListener("resize",this.handleResize)}}),gt={class:"post-card-brief"},ht={class:"post-card-tab-container"},ft={key:0},_t={key:1};function vt(e,t,c,f,_,v){const l=o("confirmDialog"),m=o("postBlogOverlay"),p=o("floatingAlert"),h=o("v-icon"),P=o("v-tab"),w=o("v-tabs"),I=o("briefIteratorList"),g=o("v-tabs-window-item"),b=o("v-tabs-window"),E=o("v-card");return n(),u(C,null,[s(l,{title:e.confirmDialogAriticles.title,subtitle:e.confirmDialogAriticles.subtitle,ref:"confirmDialogArticles",onConfirm:e.handleConfirmArticles},null,8,["title","subtitle","onConfirm"]),s(m,{ref:"postBlogOverlay",onPublishSuccess:e.PublishSuccessCb},null,8,["onPublishSuccess"]),s(p,{ref:"floatingAlert"},null,512),i("div",gt,[s(E,{class:"post-card bg-background_smooth",ref:"card"},{default:a(()=>[i("div",ht,[s(w,{modelValue:e.post_card.tab_idx,"onUpdate:modelValue":t[0]||(t[0]=$=>e.post_card.tab_idx=$),class:"post-card-tabs","slider-color":"blue-darken-2","align-tabs":"center",color:"common_selected_tabs","show-arrows":""},{default:a(()=>[(n(!0),u(C,null,S(e.post_card.tabs,($,N)=>(n(),y(P,{class:"post-card-tab",key:N,value:N},{prepend:a(()=>[e.small_width_layout?k("",!0):(n(),y(h,{key:0},{default:a(()=>[d(r($.icon),1)]),_:2},1024))]),default:a(()=>[e.small_width_layout?(n(),u("div",ft,[s(h,null,{default:a(()=>[d(r($.icon),1)]),_:2},1024)])):(n(),u("div",_t,r(e.$t($.titleKey)),1))]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),s(b,{modelValue:e.post_card.tab_idx,"onUpdate:modelValue":t[1]||(t[1]=$=>e.post_card.tab_idx=$),class:"post-card-tabs-window"},{default:a(()=>[(n(!0),u(C,null,S(e.post_card.tabs,($,N)=>(n(),y(g,{class:"brief-post-card-content",key:N,value:N},{default:a(()=>[s(I,{"is-visible":e.post_card.tab_idx===N,"items-per-page":5,"item-per-page-max":10,items:$.items,"items-length":$.itemsLength,showLimitationInfo:$.limitation!=null,"limitation-num":$.limitation??void 0,"limitation-text-key":$.limitationTextKey,menus:$.menus??void 0,onFetchData:$.cb,class:"brief-post-card-content-list"},null,8,["is-visible","items","items-length","showLimitationInfo","limitation-num","limitation-text-key","menus","onFetchData"])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])])]),_:1},512)])],64)}const yt=z(pt,[["render",vt],["__scopeId","data-v-956c0e3f"]]),wt=B({name:"InterestTagPanelSimple",components:{tag_choose_overlay:H,floatingAlert:M,newTagPrompt:Y,dynamicSearchBtn:W},props:{maxTagNumber:{type:Number,default:15}},data(){return{user:O.state.user}},computed:{userInterestTags(){return O.state.user_personal_data.interest_tags},recommendInterestTags(){return O.state.user_personal_data.recommend_tags}},methods:{async updateUserInterestTags(e){try{const t=await q.update_user_interest_tags(e);A(this.$refs.floatingAlert,!0,t)}catch(t){this.showErrorAlert(t.message)}},getTagTranslation(e){const t=this.$i18n.locale;return e[t]??e.en??e},showAddUserInterestTagOverlay(){const e=this.$refs.addUserInterestTagOverlay;e&&e.show(this.userInterestTags.slice(0))},showNewTagPrompt(){this.$refs.newTagPrompt.show()},showErrorAlert(e){A(this.$refs.floatingAlert,!1,e)},async deleteInterestTags(e){try{await K.deleteTagFromDatabase(e.map(t=>t.key)),A(this.$refs.floatingAlert,!0,this.$t("common.tag_overlay.delete_success"))}catch(t){this.showErrorAlert(t.message)}},showDeleteTagOverlay(){this.$refs.deleteUserInterestTagOverlay.show()}}}),bt={class:"interesting-tag-panel-simple"},Tt={class:"interested-tags"},$t={class:"interested-tag-header-container"},kt=["href"],Pt={class:"recommended-tags"},Dt={class:"interested-tag-header-container"},Ct=["href"],It={class:"manager-tag-add-button-container mb-2"};function At(e,t,c,f,_,v){const l=o("floatingAlert"),m=o("tag_choose_overlay"),p=o("newTagPrompt"),h=o("dynamicSearchBtn"),P=o("v-chip"),w=o("v-chip-group"),I=o("v-btn");return n(),u("div",bt,[s(l,{ref:"floatingAlert"},null,512),s(m,{ref:"addUserInterestTagOverlay",hideAfterAdd:!1,showTagContainer:!0,maxTagCount:e.maxTagNumber,allowRepeatTags:!1,onConfirm:e.updateUserInterestTags},{title:a(()=>[d(r(e.$t("common.tag_overlay.card_title_add")),1)]),"current-tags-tip":a(()=>[d(r(e.$t("common.tag_overlay.current_tags"))+"} ",1)]),_:1},8,["maxTagCount","onConfirm"]),s(m,{ref:"deleteUserInterestTagOverlay",hideAfterAdd:!1,showTagContainer:!0,maxTagCount:1e3,allowRepeatTags:!1,onConfirm:e.deleteInterestTags},{title:a(()=>[d(r(e.$t("common.tag_overlay.card_title_delete")),1)]),"current-tags-tip":a(()=>[d(r(e.$t("common.tag_overlay.selected_tags")),1)]),"add-icon":a(()=>t[2]||(t[2]=[d(r("mdi-delete-forever"))])),_:1},8,["onConfirm"]),s(p,{ref:"newTagPrompt"},null,512),s(h),i("div",Tt,[i("div",$t,r(e.$t("common.simpleTagPanel.interestedTags")),1),s(w,{class:"interested-tag-container"},{default:a(()=>[(n(!0),u(C,null,S(e.userInterestTags,(g,b)=>(n(),y(P,{size:"small",variant:"outlined",key:b,class:"interest-tag"},{default:a(()=>[i("a",{href:"/blogs?tag="+g.key},r(g[e.$i18n.locale]??g.key),9,kt)]),_:2},1024))),128)),s(P,{size:"small",variant:"outlined",class:"interest-tag","prepend-icon":e.userInterestTags.length<e.maxTagNumber?"mdi-plus-circle-outline":"mdi-minus-circle-outline",onClick:e.showAddUserInterestTagOverlay},{default:a(()=>[d(r(e.userInterestTags.length<e.maxTagNumber?e.$t("g.addNewTag"):e.$t("g.deleteTag")),1)]),_:1},8,["prepend-icon","onClick"])]),_:1})]),i("div",Pt,[i("div",Dt,r(e.$t("common.simpleTagPanel.recommendedTags")),1),s(w,{class:"recommended-tag-container"},{default:a(()=>[(n(!0),u(C,null,S(e.recommendInterestTags,(g,b)=>(n(),y(P,{size:"small",key:b,class:"interest-tag"},{default:a(()=>[i("a",{href:"/blogs?tag="+g.key},r(e.getTagTranslation(g)),9,Ct)]),_:2},1024))),128))]),_:1})]),i("div",It,[e.user.priority<=1?(n(),y(I,{key:0,class:"manager-tag-add-button",color:"info",size:"small",rounded:"",onClick:t[0]||(t[0]=g=>e.showNewTagPrompt())},{default:a(()=>[d(r(e.$t("g.addNewTagToDDatabase")),1)]),_:1})):k("",!0),s(p,{ref:"newTagPrompt"},null,512),e.user.priority<=1?(n(),y(I,{key:1,class:"manager-tag-add-button",color:"error",size:"small",rounded:"",onClick:t[1]||(t[1]=g=>e.showDeleteTagOverlay())},{default:a(()=>[d(r(e.$t("g.deleteTagFromDDatabase")),1)]),_:1})):k("",!0)])])}const St=z(wt,[["render",At],["__scopeId","data-v-fadcba3c"]]),Nt=B({name:"MainView",components:{dynamicSearchBtn:W,briefPostCard:yt,userInfoCardBrief:oe,InterestTagPanel:Ee,blog_iterator_main:fe,interest_tag_panel_simple:St},data(){return{user:O.state.user}},methods:{}}),Ot={class:"home-container"},Bt={class:"interesting-tag-column"},zt={class:"mt-4",style:{width:"95%"}},Ut={style:{width:"100%","margin-bottom":"10px"}},Vt={class:"ml-2"},Lt={class:"main-part-wrapper"},Mt={class:"main-view-body-zone-container"},Et={class:"main-view-body-zone"},Kt={class:"main-view-right-panel-container"};function Ft(e,t,c,f,_,v){const l=o("userInfoCardBrief"),m=o("dynamicSearchBtn"),p=o("InterestTagPanel"),h=o("interest_tag_panel_simple"),P=o("blog_iterator_main"),w=o("briefPostCard");return n(),u("div",Ot,[i("div",Bt,[i("div",zt,[s(l,{"use-self-profile":!0})]),i("div",Ut,[s(m,{color:"success"})]),i("div",Vt,[s(p)])]),i("div",Lt,[i("div",Mt,[s(h,{class:"interest-tag-panel-simple medium-width-panel"}),i("div",Et,[s(P)])]),i("div",Kt,[s(w)]),s(h,{class:"interest-tag-panel-simple mini-width-panel"})])])}const ia=z(Nt,[["render",Ft],["__scopeId","data-v-69204666"]]);export{ia as default};
